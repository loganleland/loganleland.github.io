<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>leland.zip</title>
</head>
  <body>
    <nav>
      <div class="nav-container">
        <a href="../index.html" class="logo">leland.zip</a>
        <ul class="nav-links">
          <li><a href="../blog.html">Blog</a></li>
          <li><a href="../contact.html">Contact</a></li>
        </ul>
      </div>
    </nav>

<!-- Table of Contents -->
    <section class="toc-container">
        <div class="toc-wrapper">
            <h2 class="toc-title">Table of Contents</h2>
            <ol class="toc-list">
                <li class="toc-item">
                    <a href="#setup" class="toc-link">Setup</a>
                    <ul class="toc-nested">
                        <li class="toc-item"><a href="#select" class="toc-link">Purchase</a></li>
                        <li class="toc-item"><a href="#bootloader" class="toc-link">Unlock Bootloader</a></li>
                        <li class="toc-item"><a href="#root" class="toc-link">Root</a></li>
                        <li class="toc-item"><a href="#host-setup" class="toc-link">Setup host device</a></li>

                     </ul>
                </li>
                
                <li class="toc-item">
                    <a href="#gpu" class="toc-link">Userspace Drivers</a>
                    <ul class="toc-nested">
                        <li class="toc-item">
                            <a href="#gpu" class="toc-link">GPU</a>
                        </li>
                    </ul>
                </li>
            </ol>
        </div>
    </section>

    <article class="article-container">
      <div class="article-content">
        <h1 id="setup">Setup</h1> <p></p>
        <h2 id="purchase">Purchase</h2> 
          <p> The following is written with a pixel 9 bought from the google store without financing. Do not unlock the bootloader or root your personal use cellphone. Unlocking the bootloader will erase data on the pixel 9 and if done incorrectly and brick the device.</p>
          <ul>
            <li> Buying from sources other than Google can block easy unlocking of the bootloader.</li>
            <li> It has been reported Verizon disallows unlocking the bootloader of financed pixel 9 and when paid off will make you jump through additional actions for unlocking the bootloader.
            <li>Note that carrier locking is different than bootloader locking</li>
          </ul>

          <p>If you don't already have a cable to connect the pixel to a laptop/desktop I would suggest the 4-1 100W cable from xcool since it can connect to all common kinds of USB ports.</p>
          <p>Depending on your use case the mission darkness window charge and shield faraday bag works well.</p>
          <p>The pixel 9 has a variety of RF attack surface and can be interesting to reverse engineer. While there's cheaper ways to go about this one option is to use a B205 mini from Ettus Research.</p>
        <ul>
          <li> https://store.google.com/product/pixel_9 </li>
          <li> https://mosequipment.com/products/mission-darkness-window-charge-shield-faraday-bag </li>
          <li> https://www.coolgadget.com/products/xcool-cable-monster-usb-c-charger-cable </li>
          <li> https://www.ettus.com/all-products/usrp-b205mini-i/ </li>          
        </ul>


         <h2 id="bootloader">Bootloader</h2> 
          <p> Unlocking the bootloader can provide the following:</p>
          <ul>
            <li>Obtain root with Magisk</li>
            <li>Downgrade to older software to develop against known vulns</li>
            <li>Rewrite kernel / vendor code for various purposes</li>
            <li>Recover from future bootloops</li>
          </ul>

          <p> 1. Enable developer mode: </p>
          <ul>
            <li>Settings -> About Phone</li>
            <li>Click on Build Number until developer mode is enabled</li>
            <li>Confirm pin/passcode if needed</li>
            <li>If you have a pin it will be requested</li>
            <li>A popup message "You are now a developer!" should appear</li>
          </ul>        

        <p> 2. Enable OEM unlocking </p>
        <ul>
          <li>Settings -> Developer Options</li>
          <li>Click: OEM unlocking</li>
          <li>Confirm pin/passcode if needed</li>
          <li>Enable: Allow OEM unlocking </li>
        </ul>

        <p> 3. Install fastboot on a laptop/desktop</p>

        <p> 4. Reboot device into fast boot mode </p>
        <ul>
          <li>Restart device</li>
          <li>Hold volume down during restart process</li>
          <li>Fastboot menu should now be visible</li>
        </ul>

        <p> 5. Fastboot unlock </p>
        <div class="callout">
          <p>This step will erase data on pixel 9</p>
        </div>
        <ul>
          <li> Connect device via usb to laptop </li>
          <li> On laptop execute: fastboot devices</li>
          <li> Ensure fastboot devices outputs a serial number. If blank there's a usb error most likely</li>
          <li> On laptop execute: fastboot flashing unlock</li>
          <li> Pixel 9 screen should display a warning regarding unlocking the bootloader </li>
          <li> Use volume buttons to change from "Do not unlock the bootloader" to "Unlock the bootloader"</li>
          <li> Press power button to trigger a a reboot</li>
          <li> Debug menu should have "Device state: unlocked"</li>
          <li> Press power button with option "Start"</li>
        </ul>

        <p> Each restart will display a warning regarding the bootloader being unlocked. Fastboot can be used to lock the bootloader.</p>
        <li> https://android.googlesource.com/platform/system/core/+/master/fastboot </li>
 
        <h2 id="root">Root</h2> 
        <p>With the bootloader unlocked Magisk can be used to provide root access.<p>
        <p> 1. Record the build number to download correct images</p>
        <ul>
          <li> Settings -> About Phone</li>
          <li> Scroll to bottom </li>
          <li> At the time of writing my pixel 9's build number is: <b>BP1A.250505.005</b> </li>
        </ul>
        <div class="callout">
          <p>Recording an incorrect build number can brick your device</p>
        </div>

        <p> 2. Obtain a factory image from https://developers.google.com/android/images for your device/build number.</p>
        <p> Each variant of the pixel devices has a codename: </p>
        <ul>
          <li> "tokay" for Pixel 9 </li>
          <li> "komodo" for Pixel 9 Pro XL </li>
          <li> "caiman" for Pixel 9 Pro </li>
          <li> "comet" for Pixel 9 Pro Fold </li>
          <li> "tegu" for Pixel 9a </li>
        </ul>

        <p> In the images site I locate <b>tokay</b> for the pixel 9 then find the correct build number from the previous step <b>BP1A.250505.005</b>. For my case the link to download is https://dl.google.com/dl/android/aosp/tokay-bp1a.250505.005-factory-5e869188.zip</p>
        <p> Take note of image variants for Verizon, DTAG, TW, EMEA, T-Mobile and Telestra. You don't want to mix and match variants (don't flash a Verizon variant if you didn't buy the pixel 9 from verizon).</p>

        <p> 3. After downloading the image check the hash matches. This helps reduce ensure the correct image will be used (reduce chance of bricking your pixel).</p>
        <pre data-language="bash"><code>leland@light:~/Downloads$ sha256sum tokay-bp1a.250505.005-factory-5e869188.zip 
5e8691883c5004c15b72ab941533a44f164b2b6bdbf8393c8987da42ec31bbd8  tokay-bp1a.250505.005-factory-5e869188.zip
        </code></pre>

        <p> 4. Extract init_boot.img from factory image on laptop</p>
        <ul>
          <li>unzip tokay-bp1a.250505.005-factory-5e869188.zip</li>
          <li>unzip image-tokay-bp1a.250505.005.zip</li>
          <li>Observe init_boot.img</li>
        </ul>

        <p> 5. Download Magisk </p>
        <li>Download the latest apk from https://github.com/topjohnwu/Magisk/releases</li>

        <p> 6. Connect and Enable USB File Transfer.</p>
        <li> Connect pixel device to laptop</li>
        <li> On the pixel: Settings -> USB Preferences</li>
        <li> Select File transfer / Android Auto</li>
        <li> Move init_boot.img to Download folder of pixel's internal storage</li>
        <li> Move Magisk apk to Download folder of pixel's internal storage</li>

        <p> 7. Install Magisk apk </p>
        <li> Enable: Install unknown apps </li>
        <li> Click Magisk apk in Downloads folder to install </li>

        <p> 8. Patch init_boot.img from Magisk </p>
        <ul>
        <li> Execute Magisk: Install </li>
        <li> Select: Select and Patch a File</li>
        <li> Select: init_boot.img. Ensure this file is from correct build otherwise the pixel will be bricked in later steps</li>
        <li> Select: LET'S GO</li>
        <li> A newly created <b>magisk_patched-29000_oMslj.img</b> should be created next to init_boot.img on the pixel</li>
        <li> Transfer <b>magisk_patched-29000_oMslj.img</b> to your laptop</li>
        </ul>

        <p> 9. Enable Developer Mode / USB Debugging</p>
        <li> Enable developer mode again since it could be wiped after unlocking the bootloader</li>
        <li> Enable USB Debugging for adb </li>
        <li> Trust laptop for usb debugging </li>

        <p> 10. Reboot into bootloader </p>
        <ul>
          <li> Trust laptop for usb debugging </li>
          <li> Execute on laptop: adb devices</li>
          <li> Ensure pixel is seen by previous command</li>
          <li> Execute on laptop: adb reboot bootloader</li>
          <li> Pixel should restart into fastboot mode</li>
        </ul>

        <p> 11. Flash patched init_boot.img </p>
        <li> Execute on laptop: fastboot flash init_boot /path/to/patched/init_boot.img</li>
        <pre data-language="bash"><code>leland@light:~/Downloads/$ fastboot flash init_boot ./magisk_patched-29000_oMsIj.img 
Sending 'init_boot_a' (8192 KB)                    OKAY [  0.364s]
Writing 'init_boot_a'                              OKAY [  0.074s]
Finished. Total time: 0.442s
        </code></pre>

        <li> Execute on laptop: fastboot reboot</li> 

        <b> Pixel is now rooted </b>

        <h2 id="host-setup">Host Setup</h2> 
      </div>
    </article>

</body>
</html>
